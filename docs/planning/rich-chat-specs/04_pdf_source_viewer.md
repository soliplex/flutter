# Feature Specification: PDF Source Highlight Viewer

## 1. Overview
The **PDF Source Highlight Viewer** is the destination when a user clicks an Interactive Citation (Feature #4). It opens the original PDF document, scrolls to the specific page, and draws a visual highlight box around the text chunk used by the AI.

## 2. Business Case
- **Auditability:** "Don't just tell me, show me." Essential for trust.
- **Context:** The AI snippet might be correct but misleading out of context. Viewing the surrounding paragraph/page clarifies intent.
- **Soliplex Core Value:** This is a key differentiator against generic chat wrappers.

## 3. UI/UX Specification
- **Display Mode:**
    - **Desktop:** A split-screen panel (Chat on left, PDF on right).
    - **Mobile:** A modal/bottom sheet covering 90% of the screen.
- **Visuals:**
    - Render the PDF page.
    - Overlay a semi-transparent yellow/blue rectangle over the coordinates provided by the backend.
    - "Close" button to return to chat focus.
- **Loading State:** Skeleton loader while fetching the heavy PDF.

## 4. Technical Implementation

### Dependencies
- `flutter_pdfview` or `pdfrx` (high performance).
- Backend must provide coordinates: `page_number`, `x`, `y`, `width`, `height` (normalized 0-1 or absolute points).

### Architecture
1. **Citation Click:** Triggers event `OpenSource(url: '...', rect: [...])`.
2. **Layout Manager:** Detects event, resizes Chat Panel to 50% width, opens PDF Panel in remaining 50%.
3. **PDF Controller:** Loads file, jumps to `page`.
4. **Canvas Overlay:** Draws the highlight rect on top of the PDF view.

```dart
class PdfHighlightOverlay extends StatelessWidget {
  final List<Rect> highlights;
  final Size pageSize;

  @override
  Widget build(BuildContext context) {
    return CustomPaint(
      painter: HighlightPainter(highlights),
      size: pageSize,
    );
  }
}
```

## 5. Codex Review
- **Complexity:** Coordinate systems are the hardest part. PDF coordinates (bottom-left origin) vs Flutter coordinates (top-left origin). Backend and Frontend must agree on the coordinate space.
- **Performance:** downloading large PDFs for a single snippet is wasteful.
    - *Optimization:* Backend should support range requests or serving single pages as images if bandwidth is low.

## 6. Skeptic Review
- "PDFs are terrible on mobile." -> **Mitigation:** Pinch-to-zoom support is mandatory. Default to "fit width".
- "What if the PDF is scanned images (OCR)?" -> **Mitigation:** Coordinates still work if generated by the OCR engine. If no coordinates, just show the page.
